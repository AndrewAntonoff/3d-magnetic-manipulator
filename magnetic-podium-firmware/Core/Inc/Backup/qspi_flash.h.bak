// qspi_flash.h

#ifndef __QSPI_FLASH_H
#define __QSPI_FLASH_H

#include "main.h" // Обычно включает HAL
#include <stdint.h>
#include <stdbool.h>
#include "config.h" // Для NUM_SENSORS

// --- ПЕРЕМЕСТИТЕ ОПРЕДЕЛЕНИЯ КАЛИБРОВКИ СЮДА ---
#define CALIBRATION_DATA_SIGNATURE 0xDEADBEEF
#define CALIBRATION_DATA_VERSION 1
#define CALIBRATION_DATA_ADDR     (0x00000000UL) // Начало флешки (измени при необходимости)



// --- Команды W25Q64JV ---
#define W25Q_WRITE_ENABLE         0x06
#define W25Q_WRITE_DISABLE        0x04
#define W25Q_READ_STATUS_REG      0x05
#define W25Q_WRITE_STATUS_REG     0x01
#define W25Q_READ_DATA            0x03
#define W25Q_FAST_READ_DATA       0x0B
#define W25Q_PAGE_PROGRAM         0x02
#define W25Q_SECTOR_ERASE         0x20
#define W25Q_CHIP_ERASE           0xC7
#define W25Q_JEDEC_ID             0x9F

// --- Прототипы ---
bool QSPI_Flash_Init(void);
uint32_t QSPI_Flash_ReadJEDECID(void);
void QSPI_Flash_EraseSector(uint32_t address);
void QSPI_Flash_WritePage(uint32_t address, const uint8_t *data, uint32_t len);
void QSPI_Flash_WriteBuffer(uint32_t address, const uint8_t *data, uint32_t len);
void QSPI_Flash_ReadBuffer(uint32_t address, uint8_t *data, uint32_t len);

#endif /* __QSPI_FLASH_H */
